<!DOCTYPE html>
<html>
    <head>
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <!-- Bootstrap core CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" type="text/css" href="css/index.css">
        <title>Hello World</title>
    </head>
    <body>

    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Chistes de Borrachos</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="#" id="btn-inicio">Inicio</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div id="principal" class="container">
        <div id="home-screen" class="screen">
            <div class="row">
                <div class="header-cont" style="background-image:url('img/borracho.png');">
                    <h3 class="header-text">Los mejores Chistes de Borrachos</h3>
                </div>
            </div>
            <div class="row">
                <div class="listado-chistes">
                    
                </div>
            </div>

            <div id="chiste-row-tpl" style="display: none;">
                <div class="chiste-row" rel="##ID##">
                   <span class="chiste-row-title"><span class="glyphicon glyphicon-play" aria-hidden="true"></span> ##Nombre##</span> 
                </div>
            </div>

            
        </div>

        <div id="chiste-screen" class="screen">
            <div class="row">
                <div id="chiste-show">
                
                </div>
            </div>
            
            <div id="chiste-controls">
                <div>
                    <a href="#" id="btn-regresar" class="btn btn-success">&lt;&lt; Regresar</a>
                </div>
            </div>
            
        </div>

        <div id="resultados">
            
        </div>
        
    </div>

    <div id="chiste-show-tpl" style="display: none;">
        <span id="chiste-show-img"></span>
        <span class="chiste-show-title">##Titulo###</span>
        <div class="chiste-show-content">##Chiste##</div>
    </div>

    


    <p id="registration"></p>
    <ul id="pushList">
    </ul>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <link href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" rel="stylesheet"/>
    <script src="js/bootstrap.min.js"></script>

    <script type="text/javascript">

    $( document ).ready(function() {

        $('#resultados').append('Iniciamos<br>');

        function initHome(){
            $('#resultados').append('desaparecimos<br>');
            $('.screen').css('display','none');

            $('#resultados').append('mostrador<br>');
            $('#home-screen').css('display','initial');

            $('#resultados').append('iniciamosajax<br>');
            $.ajax({
                url: "http://www.cronpixel.com/webapp/json-category/?category=chistes-de-borrachos",
                dataType: "JSON",
                success: function(json){
                    //here inside json variable you've the json returned by your PHP
                    var chiste_tpl = $('#chiste-row-tpl').html();
                        
                    for(var i=0;i<json.length;i++){
                        rchiste = chiste_tpl;

                        rchiste = rchiste.replace('##ID##',json[i].id);
                        rchiste = rchiste.replace('##Nombre##',json[i].title);
                        $('.listado-chistes').append(rchiste);
                    }
                },

                error: function(jqXHR, textStatus, errorThrown) {
                    //alert('An error occurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!');

                    $('#resultados').append('<p>status code: '+jqXHR.status+'</p><p>errorThrown: ' + errorThrown + '</p><p>jqXHR.responseText:</p><div>'+jqXHR.responseText + '</div>');
                    console.log('jqXHR:');
                    console.log(jqXHR);
                    console.log('textStatus:');
                    console.log(textStatus);
                    console.log('errorThrown:');
                    console.log(errorThrown);

                     if (jqXHR.status === 0) {

                        $('#resultados').append('Not connect: Verify Network.');

                      } else if (jqXHR.status == 404) {

                        $('#resultados').append('Requested page not found [404]');

                      } else if (jqXHR.status == 500) {

                        $('#resultados').append('Internal Server Error [500].');

                      } else if (textStatus === 'parsererror') {

                        $('#resultados').append('Requested JSON parse failed.');

                      } else if (textStatus === 'timeout') {

                        $('#resultados').append('Time out error.');

                      } else if (textStatus === 'abort') {

                        $('#resultados').append('Ajax request aborted.');

                      } else {

                        $('#resultados').append('Uncaught Error: ' + jqXHR.responseText);

                      }
                },
            });
        }

    
        initHome();


        $( "#principal" ).on( "click", ".chiste-row", function() {
            var rel = $(this).attr('rel');        

            $.ajax({
                url: "http://www.cronpixel.com/webapp/json-post/?element="+rel,
                dataType: "JSON",
                success: function(json){
                    //here inside json variable you've the json returned by your PHP
                    var chiste_tpl = $('#chiste-show-tpl').html();
                        
                    for(var i=0;i<json.length;i++){
                        rchiste = chiste_tpl;
                        rchiste = rchiste.replace('##Titulo##',json[i].title);
                        rchiste = rchiste.replace('##Chiste##',json[i].content);
                        if(json[i].image!=""){
                            $('#chiste-show-img').html('<img src="'+json[i].image+'" class="img-responsive">');
                        }else{
                            $('#chiste-show-img').html("");
                        }
                        $('#chiste-show').html(rchiste);
                        break;
                    }

                    $('.screen').css('display','none');
                    $('#chiste-screen').css('display','initial');
                },

                error: function(jqXHR, textStatus, errorThrown) {
                    //alert('An error occurred... Look at the console (F12 or Ctrl+Shift+I, Console tab) for more information!');

                    $('#resultados').append('<p>status code: '+jqXHR.status+'</p><p>errorThrown: ' + errorThrown + '</p><p>jqXHR.responseText:</p><div>'+jqXHR.responseText + '</div>');
                    console.log('jqXHR:');
                    console.log(jqXHR);
                    console.log('textStatus:');
                    console.log(textStatus);
                    console.log('errorThrown:');
                    console.log(errorThrown);

                     if (jqXHR.status === 0) {

                        $('#resultados').append('Not connect: Verify Network.');

                      } else if (jqXHR.status == 404) {

                        $('#resultados').append('Requested page not found [404]');

                      } else if (jqXHR.status == 500) {

                        $('#resultados').append('Internal Server Error [500].');

                      } else if (textStatus === 'parsererror') {

                        $('#resultados').append('Requested JSON parse failed.');

                      } else if (textStatus === 'timeout') {

                        $('#resultados').append('Time out error.');

                      } else if (textStatus === 'abort') {

                        $('#resultados').append('Ajax request aborted.');

                      } else {

                        $('#resultados').append('Uncaught Error: ' + jqXHR.responseText);

                      }
                },
            });

        });

        $("#btn-regresar").click(function(){
            $('.screen').css('display','none');
            $('#home-screen').css('display','initial');
        });

        $("#btn-inicio").click(function(){
            $('.screen').css('display','none');
            $('#home-screen').css('display','initial');
        });

    });
    </script>

    </body>
</html>
